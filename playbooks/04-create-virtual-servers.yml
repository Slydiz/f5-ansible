---
- name: Créer les Virtual Servers F5
  hosts: f5
  gather_facts: no
  collections:
    - f5networks.f5_modules

  vars_files:
    - ../group_vars/f5.yml

  tasks:
    - name: Créer les Virtual Servers sur F5
      bigip_virtual_server:
        provider: "{{ f5_provider }}"
        name: "{{ item.name }}"
        destination: "{{ item.destination }}"
        port: "{{ item.port }}"
        pool: "{{ item.pool }}"
        description: "{{ item.description | default(omit) }}"
        snat: "{{ item.snat | default('automap') }}"
        profiles: "{{ item.profiles | default(omit) }}"
        partition: "{{ partition }}"
        state: present
      loop: "{{ f5_virtual_servers }}"
      delegate_to: localhost
      register: vs_result

    - name: Afficher le résultat
      debug:
        msg: "Virtual Server {{ item.item.name }} créé sur {{ item.item.destination }}:{{ item.item.port }}"
      loop: "{{ vs_result.results }}"
      when: item.changed
